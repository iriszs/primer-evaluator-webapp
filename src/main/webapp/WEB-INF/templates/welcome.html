<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-4.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title th:text="#{title.msg}"> Offline primer evaluator </title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body>
<h1 th:text="#{welcome.msg}">Welcome to the primer evaluator. The server is currently offline.</h1>
<div>
    <p th:text="#{properties.msg}">This tool evaluates any given primer on the following properties: </p>
    <br>
    <ul>
        <li> <p th:text="#{prop1.msg}">Only containing A, C, T and G nucleotides</p> </li>
        <li> <p th:text="#{prop2.msg}">The length of the primer</p> </li>
        <li> <p th:text="#{prop3.msg}">GC%</p> </li>
        <li> <p th:text="#{prop4.msg}">Melting temperature in Celsius</p> </li>
        <li> <p th:text="#{prop5.msg}">Homopolymer length</p> </li>
        <li> <p th:text="#{prop6.msg}">Intramolecular binding length</p> </li>
        <li> <p th:text="#{prop7.msg}">In case of two primers: intermolecular binding length</p> </li>

    </ul>
<br>
</div>
<p th:text="#{fileupload.msg}">Upload your file containing primers here</p>

<form action="data_upload" method="post" enctype="multipart/form-data">
    <input type="file" name="sequence_file" accept="text">
    <input type="submit" value="Upload" />
</form>


</div>


<div>
<p th:text="#{manually.msg}">Or enter your primers here:</p>

<form id="manualInputForm">
    <label for="primer_a"> Forward primer: 5-'</label>
    <input type="text" id="primer_a" name="primer_a" minlength="18" maxlength="22" pattern= "^[ATCGatcg]*$" placeholder= "ACTGACTGACTGACTGAT" title="Please enter a primer sequence only containing nucleotides and between 18-22 nucleotides long" required>
    -3'
    <br><br>
    <label for="primer_b">Reverse primer (optional): 3'-</label>
    <input type="text" id="primer_b" name="primer_b" minlenght="18" maxlength="22" pattern= "^[ATCGatcg]*$" placeholder="TAGTCAGTCAGTCAGTCA" title="Please enter a primer sequence only containing nucleotides and between 18-22 nucleotides long" >
    -5'
    <br><br>
</form>
    <button id="manualSubmitBtn">Evaluate</button>
</div>
<script>
    document.getElementById("manualSubmitBtn").addEventListener("click", _e => {
        let a = document.getElementById('primer_a').value
        let b = document.getElementById('primer_b').value

        let manualSubmitReq = $.ajax({
            url: "/manual_upload.do?a=" + a + "&b=" + b,
            method: 'GET',
        })

        manualSubmitReq.then((e, _, xhr) => {
            switch(xhr.status) {
                case 400:
                case 500:
                    alert(e)
                    return
                case 200:
                    window.sessionStorage.setItem('results', e)
                    window.location.href = 'results'
            }
        })
    })
</script>
</body>
</html>